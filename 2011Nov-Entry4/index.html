<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Statistical Methods Online - Randomization and P-Values</title>
  <style>
    body {
      background-color: #f2f2f2;
      font-family: "Courier New", Courier, monospace;
      color: #222;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #002244;
      color: #fff;
      padding: 20px;
      text-align: center;
    }

    .container {
      width: 780px;
      margin: 40px auto;
      background-color: #fff;
      padding: 30px;
      border: 2px solid #aaa;
      box-shadow: 4px 4px 0 #aaa;
    }

    h1, h2, h3 {
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }

    .code-block {
      background-color: #f8f8f8;
      border: 1px dashed #888;
      padding: 15px;
      margin: 20px 0;
      white-space: pre-wrap;
      overflow-x: auto;
      font-family: Consolas, monospace;
      font-size: 0.9em;
    }

    .caption {
      font-size: 0.85em;
      font-style: italic;
      text-align: center;
      color: #555;
      margin-top: -10px;
      margin-bottom: 20px;
    }

    img.broken {
      display: block;
      width: 320px;
      height: 200px;
      background-color: #ddd;
      border: 1px solid #aaa;
      margin: 20px auto 5px auto;
    }

    footer {
      font-size: 0.75em;
      color: #666;
      text-align: center;
      padding: 30px 10px;
      margin-top: 50px;
      background-color: #e0e0e0;
      border-top: 1px solid #aaa;
    }

    .section {
      margin-bottom: 50px;
    }

    .warning {
      background-color: #fff3cd;
      border: 1px solid #ffeeba;
      padding: 10px;
      margin: 15px 0;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <header>
    <h1>Statistical Methods Online</h1>
    <p><i>Technical Archive Entry – November 2011</i></p>
  </header>

  <div class="container">
    <div class="section">
      <h1>Randomization-Based Hypothesis Testing in R</h1>
      <p>
        In randomization testing, p-values are computed empirically by comparing the observed statistic to a distribution
        generated by randomly shuffling or resampling data under the assumption that the null hypothesis is true.
        This entry provides a reference implementation for computing such p-values in R, tailored to the nature of
        the alternative hypothesis.
      </p>
    </div>

    <div class="section">
      <h2>Core Function for P-value Calculation</h2>
      <p>
        The following function accepts an observed test statistic, a vector of resampled statistics (randomization distribution),
        and a keyword indicating the hypothesis direction. It returns the proportion of values in the distribution that
        are as extreme or more extreme than the observed result.
      </p>
      <div class="code-block">
<code>
pvalue = function(stat, rand_dist, direction) {

  if (direction == "lower") {
    p = mean(rand_dist <= stat)

  } else if (direction == "higher") {
    p = mean(rand_dist >= stat)

  } else if (direction == "either") {
    extreme = abs(rand_dist - mean(rand_dist)) >= abs(stat - mean(rand_dist))
    p = mean(extreme)

  } else {
    return("error, invalid direction value")
  }

  return(p)
}
</code>
      </div>
      <p>
        The function handles all common hypothesis types. Ensure the direction value is typed correctly, as no default is assumed.
      </p>
    </div>

    <img class="broken" src="rand_dist_hist.png" alt="">
    <div class="caption">Figure 1: Randomization distribution of mean differences</div>

    <div class="section">
      <h2>Generating a Randomization Distribution</h2>
      <p>
        Suppose we are testing for a difference in mean outcome between two groups. The code below shows how to generate
        a null distribution by randomly permuting group labels and recalculating the mean difference repeatedly.
      </p>

      <div class="code-block">
<code>
set.seed(12)
group1 = rnorm(30, mean = 5)
group2 = rnorm(30, mean = 5.3)

obs_stat = mean(group1) - mean(group2)

combined = c(group1, group2)
n1 = length(group1)

rand_dist = replicate(1000, {
  shuffled = sample(combined)
  mean(shuffled[1:n1]) - mean(shuffled[(n1 + 1):length(shuffled)])
})
</code>
      </div>
      <p>
        The resulting vector <code>rand_dist</code> contains the values against which we compare the observed difference.
      </p>
    </div>

    <img class="broken" src="example_two_sample_output.jpg" alt="">
    <div class="caption">Figure 2: Output comparison of observed vs. simulated values</div>

    <div class="section">
      <h2>Example: Applying the P-value Function</h2>
      <p>
        Once both the observed statistic and null distribution are available, apply the p-value function accordingly:
      </p>
      <div class="code-block">
<code>
pvalue(obs_stat, rand_dist, "either")
</code>
      </div>
      <p>
        The above call yields a two-sided p-value for the test of difference in means between the two samples.
      </p>
    </div>

    <div class="section">
      <h2>Important Considerations</h2>
      <ul>
        <li>Ensure your sample sizes are appropriate for randomization testing assumptions.</li>
        <li>Use <code>set.seed()</code> to preserve reproducibility of simulation results.</li>
        <li>Always validate the shape and characteristics of your generated null distribution before using it for inference.</li>
      </ul>
      <div class="warning">
        Avoid using inconsistent test direction labels. Only use "lower", "higher", or "either" as exact string values.
      </div>
    </div>
  </div>

  <footer>
    Statistical Methods Online © 2005–2012 | Archived Copy Dated: February 2012 |
    <a href="#" onclick="throw new Error('Archive load error: file missing.')">About</a> |
    <a href="#" onclick="throw new Error('Privacy link unreachable.')">Privacy</a>
  </footer>
</body>
</html>
